language: node_js
node_js:
  - "7"

sudo: false 
dist: trusty 

env:
    global:
        - secure: "qAuFIDNQITDSoQdmyEtbATXDZ0kbC8AzjLCdBmTlHEwXU6VFKoOtci5amWpQbTsFTS9h2/WG1Qt3PIejhbTHhwE2ItM31VzQg0NtbcQdN3Hcmw22mbjEHTRaUgJM18gdGTwThSRfHK4nq9RPeoQC5qqjvCqDv8bZ4RAADQMy7LyaXPKMUR52iB1n7g0DZx55LVbeuB0/JFcXDHh/k6BirrqMrMsIopfDjIsotHPveJ+8wvnkzTEN1n6ZgCCSRQzeYAQ1GhEtByXbfGoNYbrdKbRKqvDvE9Ul3UX3faRy2QR6rgPU753XyKoP5PXrg2B9HnYN9681g1nQTjTFW7AReV1Rzi3hXrg0QRVTxxUMoFncjULxiIo1OrKb/S13s4UFupo7bVJ5xi62n4pOLr+t9DYBqDRcTvtLav7LOf/7nXpLoL1TR129Zu3ZAOfzlTQMs82c0p12HyVBvjx/CClMs45fWfO7E+uZsTS6RpRMmfALnCyVzNmig7xo3ykpP5lzNV5m/MJHya0n5pAreYD3iXG8u6lMh2toHINRG8KkQzOnyiH5oK3V6yUYca8VK+5aPeH5vPbtPT9eczQ7bw9dI5uxxBi0BgdYmyVn7QNubv/IchcDLFiNdZICTvI2a8/3BcMd9388mCc4oPw3vzLipaSNGxpHNtL0q7i/sn+quXM=" 
        - secure: "TEfc491WUZJwCE006Sks7fMCvM2TOyWCCI1ZU/VwXtR9qrCg3qYNXRW77AA/fSskR+6vJ63mlaS5+Q3TCo55vAWaLNQ+GeJAIq54TqLA/vtC+SQf6+FWH2Q1uowas+aXtFbM1hkfYU+RCKFduB2kTaY1ZEqJujz1FwjPGMjJbS61MLtbHtykdV6U0ZmlKUsyTNQ4davBVTG3KURwaH5Cs/FVAWdRB6MV/fY8wFElVEgYCVtdC/y2FkKa/+RLRnpHgqM8iu5N7rEEyu0x80Dhj0o0/G00WTEdnYWwu+U+PKMQxKXC7d2Ym/51uKxk4H+r4YELr1D65CkoDPuXcrcv9h/DXrVy82NRACh1ndQWpczA0cUVYxWLvqBw8TOWirSVtjOJRyxewdBRefglxHi0E2Nf0d+/T0V2vmX9wIipsMhPXipU3kEAk9J2xdcX+nN1NlD1x6f3uV4VJpbl7ngmucq8H+YAOpAW1CXVGBxHmA75KbjS6YTgdK/rxsYVtKEDoI0H8HLUVnVsFN3nzMElYDWy530MTOWFnR6uwjaiP5JgjSOktfTOYQ+GMpARs4imfktmeIXBlX5rUM+71XmflyFko3JqtXoZOuOZw9vthU3sdwFaC80pkKyrFKX4sJuxCx30LDqLnL1cnlxV8szALvR+absH+ZkXijCaanllUSc="
        - secure: "I2iRB9hG/937XQzaYtqm1yieKrIGtYpg56dDzYI5bHngW9wdnkMV5Xlt3fGvYkqnonrdsYIOuVeSDdO9mVhyharLk1Uy4Vo2UnJe7tvt25vXUTKDKyQh9y9b+hl9p6e8PVZzE/k5pGGIQHcPMAlCmp+m9aEmVyLOuAWPHOSjEUbd/RNUendeoP28jv7yqavPm7Sb0vAWxf4ao0JU8IYVcGTccF0CcybK2HZs+SR1YFkzVmz+UKMYovAAHStzO2SLMobIB99blGDKBdpYTcp3Ai7M82utsLw6DTZX/Jrfd2tZR7bjaRbx88G53ov9g/L0hOU3KPEXZeFf/cMB4PHOVEfK1SsT3j0jGDEaIhWiwM7kt8qHi2hLybzF1bZB/W8PcKjaHaCLvuPFwpfvEqyhZAKWpq8VINaJiuuj6i3zZA2eUJu2J0o/dKkk77V3p4e4yQaLnQXGAV2bORAHhX+q6twX8jTGabnaT0t3n2NgtejrqC3lF5ztwGuKl9fnrnWsuzpLc4xMfDUVvzXVas3dfPP6pz+UkNi1AG9dIt+uPcva8XBqEsUoqWbG/n2uvBpb46hhE9+RuDuifLKnSUPel1OeWR6HmiGvi131xZrv1I7rjAjjvMVDP24bmLgWrs+y/ou09hWANIynfzUedhS1/aUso58ItXWnPmu4GNJWJaY="
        - secure: "KxCdFthHH9lHKIMtt2WLZk286Kh+HM7P1vSepe6w7s+8m/MNSFFaUGhr+gGctKehDAO3976109u5Arx94wyFRTqFgyGMMdlRPehCXvdWye/eJfaDStu96IvujEjgbG1J54flVgf2PNdxOmnSrZUtOrcx6CwumMetghzVBPPSMI22r25TQRcILkAlN+GyYord4sKSz8EGRG1XjGrH85odQyXmiVHAbw3dQurExcCmco5NMp7KJMgfaDfgETOu4Jt/NmJ2my+7alJEAfUDoAhdDLZk/4mjtt7McswAmBybGsTGxSRDwaFOgekv1EjWxNOtyT+Yo88YRbow4XKRTVZhFS1vsmuAdQNqSL0hj1oBUQrY7vv/9jcVQ73xsnSGNtjTKumDJMW0ivdP/OTO1BrVdtHQT5f20yEui3OOLkWfMtXUV4lQfTAqUXOs9f/AQ4JNGUQz360hHKeSr4L50PgEiRYIqAx99kzXJqCfD+zp6659Z3kZ/XBxd+mE8GlmFHZt1nxCjRZoHayKp5C2cka6d3GpLxZpNtK3M4fQj73kyDfyBc1tl819hNLcC+1vo5c7YQVmgwmPgRxOXmhP5+HvgCVbtADKww6CI72/vPTInzMh06aqESVmbWzQjiXeAfSj8aeQg/STT+3N0fgY4bMGwqeKbSnxwzxBtTHdUHNtHBk=" 
        - secure: "mVFFYnK218vBK08dWCspzywsjo3aHB3Htj/TyaO/+i9BtDe/TiFsZxN/4SJkiEzvUJM7ofqwMR6TfaOghhqqJmBfn+uLUWGWxcaAn5CBruDlFSf/xFMof9Uu9Tr5EF41yThPixBYBaxyur3szPkRK9KMtQeIR5mO/rqL/TU+Efstc+wlgG8cCAGiQkBeURZ6XJFt7tumy1GTeww43VM0M6R86u9AYFRp5vmGb4odVZ6ckm6f8UYpxtF4k2vyEi3MSSz+G4yf6Jzk0DsEAFmkNzDtgT9pfXyLYJ1xG30NsILpFqUdufWCxaV3sk2SjOAiPd1lCWGWTfy2CtGojWFSJy/oATGqFLFqQh2UUT8WJFNj49wPTxnIb9YN6VZ1x+FHnTOH/KKfuMscvmheGSr6j9i4IYqQsEekc5qD9heGOx37cBSokZTAtRvxBmUwSfG5HxsyalnNhkFQMwafVSnQYxM9xH6vWCyR2aa3b3NvaB6zZt9wHBp51xavTtY1tiFZ3io/Eh8QV8YaE3kFsI9VUK+YKJTYNE14B0CcTl6i7lRbbMhHnUaHjWzyY/8IE/Cft/vXL5IHLAJLOVFwB163Rx2gdnCUbdFm43wR+LcIeYRyhVKoVWr3AyIdHcayfJB/dl21gsrWx+Dgr7jiiEYaFx6n4ey62VK71pOgEnI+fhA="
         - secure: "Ar97/VH9UMZFks0r/mD33SvebcncXqI7UhpgY3t6e/a9ug2xeTuKJpQZevjzVo5u/l9KVzi++LIqYSUCVoYMxRpLTxcdyjG9mCMm/7Dd0KR6Gzc4+7OtR3ZUBaqBEH5gi+EITQnIPXZ7nZmlrQwyJvugQ60zza4MOX0sZhT6dkA06T7pmFXhpC4z4UxH23D2NuF4RuI1eTH0aCyVAzN+T+8HBLtvxqe7XzZQ6eyu9PhRL1u8OiiZbOWXBsrbWElA99FAA925+SO3mK+oJ9cwG+w3Vf3dahPvxad9SrlKVMKcg/+V+IN92OCz1wc7Dh44FkcJ3+Pn0fTK3H7wxobFHZ/BEW4gUHfekmK4zbHvuSIpGEaalCVe/eqVeicbaBChdakAffwkgri+Xoikv7owkGl7VlrPQ6kwZk5o719G12Gwoqkgm1uEHGswyE16QH/wjZ7xM4w29DejFFAGX8ahbPtanFR1ceSd1H4kAuxZ3YS5UqN60tmxzq7mCJt/nmJmvIMgrzWQtwk7Ti+o5we1/BYTclTMmiV9qBpQNxJ7uTTpYNveWwqS/KAybKYKjOR/zEMfiyOhoZGTIzju7QsasUhzGOrNQNGHn1x4R5jUVLTmtwLPAgoY4iGuz6bRQ6lGF6GMWJ4L2rVTK2g/O3OAGPq80sbulQGj9MSj86AiyQs="
cache:
    directories: 
    - node_modules 

install: 
  - npm install 

script: 
# first build is needed, since webpack-typings-for-css-loader produces typings AFTER typescript-loader tries to load
# them. as far as I researched there is no easy way to fix it. Second build succeeds, because of typings from the first build  
  - npm run build:production || true 
  - npm run build:production 

before_deploy:
    - openssl aes-256-cbc -K $encrypted_0faef1a5218f_key -iv $encrypted_0faef1a5218f_iv -in .travis/deploy_rsa.enc -out /tmp/deploy_rsa -d
    - eval "$(ssh-agent -s)"
    - chmod 600 /tmp/deploy_rsa
    - ssh-add /tmp/deploy_rsa

      
deploy:
  provider: script
  skip_cleanup: true
  script: 
        scp -o  StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null -qrP $PRECICE_PORT  build/. $PRECICE_USR@$PRECICE_VM:$TRAVIS_TEST_FOLDER && ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null $PRECICE_USR@$PRECICE_VM "cp -r $TRAVIS_TEST_FOLDER/. $PRECICE_BUILD_FOLDER/"
  on:
    branch: master
